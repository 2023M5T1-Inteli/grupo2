<!DOCTYPE html>
<html>
<head>
    <title>Topographic Map</title>
    <meta charset='utf-8' />
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/Turf.js/6.5.0/turf.min.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        #scale { position: absolute; bottom: 10px; left: 10px; z-index: 1; background-color: white; padding: 5px; border-radius: 5px; }
    </style>
</head>
<body>
    <div id='map'></div>
    <div id='scale'></div>
    <script>
        // Your Mapbox access token 
        mapboxgl.accessToken = 'pk.eyJ1IjoiYmVueWludGVsaSIsImEiOiJjbGYwM25oaWMwMjRwM3Vta2tiMjd2eGk3In0.yAOpHb-ul9chFeWMM1KOeg';

        // Static map boundaries
        var xmin = -48.99954;
        var ymin = -29.99865;
        var xmax = -42.00076;
        var ymax = -20.99988;

        // Initialize the map
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/outdoors-v11',
            center: [-(xmin + xmax) / 2, (ymin + ymax) / 2],
            zoom: 2,
            maxBounds: [[xmin, ymin], [xmax, ymax]]
        });

        // Add scale control to the map
        var scale = new mapboxgl.ScaleControl({
            maxWidth: 100,
            unit: 'metric'
        });
            map.addControl(scale);

// Add a line layer to display the route between origin and destiny
map.on('load', function () {
    map.addSource('route', {
        'type': 'geojson',
        'data': {
            'type': 'Feature',
            'properties': {},
            'geometry': {
                'type': 'LineString',
                'coordinates': coordinates
            }
        }
    });

    map.addLayer({
        'id': 'route',
        'type': 'line',
        'source': 'route',
        'layout': {
            'line-join': 'round',
            'line-cap': 'round'
        },
        'paint': {
            'line-color': '#1db7dd',
            'line-width': 4,
            'line-dasharray': [0, 1]
        }
    });
});

const coordinates = [[-45.00013888888889, -21.99986111111111], [-45.00013888888889, -22.00125], [-45.00013888888889, -22.002638888888885], [-45.00013888888889, -22.004027777777775], [-45.00013888888889, -22.005416666666665], [-45.00013888888889, -22.00680555555555], [-45.00013888888889, -22.00819444444444], [-45.00013888888889, -22.00958333333333], [-45.00013888888889, -22.01097222222222], [-45.00013888888889, -22.012361111111108], [-45.00013888888889, -22.013749999999998], [-45.00013888888889, -22.015138888888888], [-45.00013888888889, -22.016527777777775], [-45.00013888888889, -22.017916666666665], [-45.00013888888889, -22.019305555555555], [-45.00013888888889, -22.02069444444444], [-45.00013888888889, -22.02208333333333], [-45.00013888888889, -22.02347222222222], [-45.00013888888889, -22.024861111111107], [-45.00013888888889, -22.026249999999997], [-45.00013888888889, -22.027638888888887], [-45.00013888888889, -22.029027777777774], [-45.00013888888889, -22.030416666666664], [-45.00013888888889, -22.031805555555554], [-45.00013888888889, -22.033194444444444], [-45.00013888888889, -22.03458333333333], [-45.00013888888889, -22.03597222222222], [-45.00013888888889, -22.03736111111111], [-45.00013888888889, -22.038749999999997], [-45.00013888888889, -22.040138888888887], [-45.00013888888889, -22.041527777777777], [-45.00013888888889, -22.042916666666663], [-45.00013888888889, -22.044305555555553], [-45.00013888888889, -22.045694444444443], [-45.00013888888889, -22.04708333333333], [-45.00013888888889, -22.04847222222222], [-45.00013888888889, -22.04986111111111], [-45.00013888888889, -22.051249999999996], [-45.00013888888889, -22.052638888888886], [-45.00013888888889, -22.054027777777776], [-45.00013888888889, -22.055416666666666], [-45.00013888888889, -22.056805555555552], [-45.00013888888889, -22.058194444444442], [-45.00013888888889, -22.059583333333332], [-45.00013888888889, -22.06097222222222], [-45.00013888888889, -22.06236111111111], [-45.00013888888889, -22.06375], [-45.00013888888889, -22.065138888888885], [-45.00013888888889, -22.066527777777775], [-45.00013888888889, -22.067916666666665], [-45.00013888888889, -22.06930555555555], [-45.00013888888889, -22.07069444444444], [-45.00013888888889, -22.07208333333333], [-45.00013888888889, -22.07347222222222], [-45.00013888888889, -22.074861111111108], [-45.00013888888889, -22.076249999999998], [-45.00013888888889, -22.077638888888888], [-45.00013888888889, -22.079027777777775], [-45.00013888888889, -22.080416666666665], [-45.00013888888889, -22.081805555555555], [-45.00013888888889, -22.08319444444444], [-45.00013888888889, -22.08458333333333], [-45.00013888888889, -22.08597222222222], [-45.00013888888889, -22.087361111111107], [-45.00013888888889, -22.088749999999997], [-45.00013888888889, -22.090138888888887], [-45.00013888888889, -22.091527777777774], [-45.00013888888889, -22.092916666666664], [-45.00013888888889, -22.094305555555554], [-45.00013888888889, -22.095694444444444], [-45.00013888888889, -22.09708333333333], [-45.00013888888889, -22.09847222222222], [-45.00013888888889, -22.09986111111111], [-45.00013888888889, -22.101249999999997], [-45.00013888888889, -22.102638888888887], [-45.00013888888889, -22.104027777777777], [-45.00013888888889, -22.105416666666663], [-45.00013888888889, -22.106805555555553], [-45.00013888888889, -22.108194444444443], [-45.00013888888889, -22.10958333333333], [-45.00013888888889, -22.11097222222222], [-45.00013888888889, -22.11236111111111], [-45.00013888888889, -22.113749999999996], [-45.00013888888889, -22.115138888888886], [-45.00013888888889, -22.116527777777776], [-45.00013888888889, -22.117916666666666], [-45.00013888888889, -22.119305555555552], [-45.00013888888889, -22.120694444444442], [-45.00013888888889, -22.122083333333332], [-45.00013888888889, -22.12347222222222], [-45.00013888888889, -22.12486111111111], [-45.00013888888889, -22.12625], [-45.00013888888889, -22.127638888888885], [-45.00013888888889, -22.129027777777775], [-45.00013888888889, -22.130416666666665], [-45.00013888888889, -22.13180555555555], [-45.00013888888889, -22.13319444444444], [-45.00013888888889, -22.13458333333333], [-45.00013888888889, -22.13597222222222], [-45.00013888888889, -22.137361111111108], [-45.00013888888889, -22.138749999999998], [-45.00013888888889, -22.140138888888888], [-45.00013888888889, -22.141527777777775], [-45.00013888888889, -22.142916666666665], [-45.00013888888889, -22.144305555555555], [-45.00013888888889, -22.14569444444444], [-45.00013888888889, -22.14708333333333], [-45.00013888888889, -22.14847222222222], [-45.00013888888889, -22.149861111111107], [-45.00013888888889, -22.151249999999997], [-45.00013888888889, -22.152638888888887], [-45.00013888888889, -22.154027777777774], [-45.00013888888889, -22.155416666666664], [-45.00013888888889, -22.156805555555554], [-45.00013888888889, -22.158194444444444], [-45.00013888888889, -22.15958333333333], [-45.00013888888889, -22.16097222222222], [-45.00013888888889, -22.16236111111111], [-45.00013888888889, -22.163749999999997], [-45.00013888888889, -22.165138888888887], [-45.00013888888889, -22.166527777777777], [-45.00013888888889, -22.167916666666663], [-45.00013888888889, -22.169305555555553], [-45.00013888888889, -22.170694444444443], [-45.00013888888889, -22.17208333333333], [-45.00013888888889, -22.17347222222222], [-45.00013888888889, -22.17486111111111], [-45.00013888888889, -22.176249999999996], [-45.00013888888889, -22.177638888888886], [-45.00013888888889, -22.179027777777776], [-45.00013888888889, -22.180416666666666], [-45.00013888888889, -22.181805555555552], [-45.00013888888889, -22.183194444444442], [-45.00013888888889, -22.184583333333332], [-45.00013888888889, -22.18597222222222], [-45.00013888888889, -22.18736111111111], [-45.00013888888889, -22.18875], [-45.00013888888889, -22.190138888888885], [-45.00013888888889, -22.191527777777775], [-45.00013888888889, -22.192916666666665], [-45.00013888888889, -22.19430555555555], [-45.00013888888889, -22.19569444444444], [-45.00013888888889, -22.19708333333333], [-45.00013888888889, -22.19847222222222], [-45.00013888888889, -22.199861111111108], [-45.00013888888889, -22.201249999999998], [-45.00013888888889, -22.202638888888888], [-45.00013888888889, -22.204027777777775], [-45.00013888888889, -22.205416666666665], [-45.00013888888889, -22.206805555555555], [-45.00013888888889, -22.20819444444444], [-45.00013888888889, -22.20958333333333], [-45.00013888888889, -22.21097222222222], [-45.00013888888889, -22.212361111111107], [-45.00013888888889, -22.213749999999997], [-45.00013888888889, -22.215138888888887], [-45.00013888888889, -22.216527777777774], [-45.00013888888889, -22.217916666666664], [-45.00013888888889, -22.219305555555554], [-45.00013888888889, -22.220694444444444], [-45.00013888888889, -22.22208333333333], [-45.00013888888889, -22.22347222222222], [-45.00013888888889, -22.22486111111111], [-45.00013888888889, -22.226249999999997], [-45.00013888888889, -22.227638888888887], [-45.00013888888889, -22.229027777777777], [-45.00013888888889, -22.230416666666663], [-45.00013888888889, -22.231805555555553], [-45.00013888888889, -22.233194444444443], [-45.00013888888889, -22.23458333333333], [-45.00013888888889, -22.23597222222222], [-45.00013888888889, -22.23736111111111], [-45.00013888888889, -22.238749999999996], [-45.00013888888889, -22.240138888888886], [-45.00013888888889, -22.241527777777776], [-45.00013888888889, -22.242916666666666], [-45.00013888888889, -22.244305555555552], [-45.00013888888889, -22.245694444444442], [-45.00013888888889, -22.247083333333332], [-45.00013888888889, -22.24847222222222], [-45.00013888888889, -22.24986111111111], [-45.00013888888889, -22.25125], [-45.00013888888889, -22.252638888888885], [-45.00013888888889, -22.254027777777775], [-45.00013888888889, -22.255416666666665], [-45.00013888888889, -22.25680555555555], [-45.00013888888889, -22.25819444444444], [-45.00013888888889, -22.25958333333333], [-45.00013888888889, -22.26097222222222], [-45.00013888888889, -22.262361111111108], [-45.00013888888889, -22.263749999999998], [-45.00013888888889, -22.265138888888888], [-45.00013888888889, -22.266527777777775], [-45.00013888888889, -22.267916666666665], [-45.00013888888889, -22.269305555555555], [-45.00013888888889, -22.27069444444444], [-45.00013888888889, -22.27208333333333], [-45.00013888888889, -22.27347222222222], [-45.00013888888889, -22.274861111111107], [-45.00013888888889, -22.276249999999997], [-45.00013888888889, -22.277638888888887], [-45.00013888888889, -22.279027777777774], [-45.00013888888889, -22.280416666666664], [-45.00013888888889, -22.281805555555554], [-45.00013888888889, -22.283194444444444], [-45.00013888888889, -22.28458333333333], [-45.00013888888889, -22.28597222222222], [-45.00013888888889, -22.28736111111111], [-45.00013888888889, -22.288749999999997], [-45.00013888888889, -22.290138888888887], [-45.00013888888889, -22.291527777777777], [-45.00013888888889, -22.292916666666663], [-45.00013888888889, -22.294305555555553], [-45.00013888888889, -22.295694444444443], [-45.00013888888889, -22.29708333333333], [-45.00013888888889, -22.29847222222222], [-45.00013888888889, -22.29986111111111], [-45.00013888888889, -22.301249999999996], [-45.00013888888889, -22.302638888888886], [-45.00013888888889, -22.304027777777776], [-45.00013888888889, -22.305416666666666], [-45.00013888888889, -22.306805555555552], [-45.00013888888889, -22.308194444444442], [-45.00013888888889, -22.309583333333332], [-45.00013888888889, -22.31097222222222], [-45.00013888888889, -22.31236111111111], [-45.00013888888889, -22.31375], [-45.00013888888889, -22.315138888888885], [-45.00013888888889, -22.316527777777775], [-45.00013888888889, -22.317916666666665], [-45.00013888888889, -22.31930555555555], [-45.00013888888889, -22.32069444444444], [-45.00013888888889, -22.32208333333333], [-45.00013888888889, -22.32347222222222], [-45.00013888888889, -22.324861111111108], [-45.00013888888889, -22.326249999999998], [-45.00013888888889, -22.327638888888888], [-45.00013888888889, -22.329027777777775], [-45.00013888888889, -22.330416666666665], [-45.00013888888889, -22.331805555555555], [-45.00013888888889, -22.33319444444444], [-45.00013888888889, -22.33458333333333], [-45.00013888888889, -22.33597222222222], [-45.00013888888889, -22.337361111111107], [-45.00013888888889, -22.338749999999997], [-45.00013888888889, -22.340138888888887], [-45.00013888888889, -22.341527777777774], [-45.00013888888889, -22.342916666666664], [-45.00013888888889, -22.344305555555554], [-45.00013888888889, -22.345694444444444], [-45.00013888888889, -22.34708333333333], [-45.00013888888889, -22.34847222222222], [-45.00013888888889, -22.34986111111111], [-45.00013888888889, -22.351249999999997], [-45.00013888888889, -22.352638888888887], [-45.00013888888889, -22.354027777777777], [-45.00013888888889, -22.355416666666663], [-45.00013888888889, -22.356805555555553], [-45.00013888888889, -22.358194444444443], [-45.00013888888889, -22.35958333333333], [-45.00013888888889, -22.36097222222222], [-45.00013888888889, -22.36236111111111], [-45.00013888888889, -22.363749999999996], [-45.00013888888889, -22.365138888888886], [-45.00013888888889, -22.366527777777776], [-45.00013888888889, -22.367916666666666], [-45.00013888888889, -22.369305555555552], [-45.00013888888889, -22.370694444444442], [-45.00013888888889, -22.372083333333332], [-45.00013888888889, -22.37347222222222], [-45.00013888888889, -22.37486111111111], [-45.00013888888889, -22.37625], [-45.00013888888889, -22.377638888888885], [-45.00013888888889, -22.379027777777775], [-45.00013888888889, -22.380416666666665], [-45.00013888888889, -22.38180555555555], [-45.00013888888889, -22.38319444444444], [-45.00013888888889, -22.38458333333333], [-45.00013888888889, -22.38597222222222], [-45.00013888888889, -22.387361111111108], [-45.00013888888889, -22.388749999999998], [-45.00013888888889, -22.390138888888888], [-45.00013888888889, -22.391527777777775], [-45.00013888888889, -22.392916666666665], [-45.00013888888889, -22.394305555555555], [-45.00013888888889, -22.39569444444444], [-45.00013888888889, -22.39708333333333], [-45.00013888888889, -22.39847222222222], [-45.00013888888889, -22.399861111111107], [-45.00013888888889, -22.401249999999997], [-45.00013888888889, -22.402638888888887], [-45.00013888888889, -22.404027777777774], [-45.00013888888889, -22.405416666666664], [-45.00013888888889, -22.406805555555554], [-45.00013888888889, -22.408194444444444], [-45.00013888888889, -22.40958333333333], [-45.00013888888889, -22.41097222222222], [-45.00013888888889, -22.41236111111111], [-45.00013888888889, -22.413749999999997], [-45.00013888888889, -22.415138888888887], [-45.00013888888889, -22.416527777777777], [-45.00013888888889, -22.417916666666663], [-45.00013888888889, -22.419305555555553], [-45.00013888888889, -22.420694444444443], [-45.00013888888889, -22.42208333333333], [-45.00013888888889, -22.42347222222222], [-45.00013888888889, -22.42486111111111], [-45.00013888888889, -22.426249999999996], [-45.00013888888889, -22.427638888888886], [-45.00013888888889, -22.429027777777776], [-45.00013888888889, -22.430416666666666], [-45.00013888888889, -22.431805555555552], [-45.00013888888889, -22.433194444444442], [-45.00013888888889, -22.434583333333332], [-45.00013888888889, -22.43597222222222], [-45.00013888888889, -22.43736111111111], [-45.00013888888889, -22.43875], [-45.00013888888889, -22.440138888888885], [-45.00013888888889, -22.441527777777775], [-45.00013888888889, -22.442916666666665], [-45.00013888888889, -22.44430555555555], [-45.00013888888889, -22.44569444444444], [-45.00013888888889, -22.44708333333333], [-45.00013888888889, -22.44847222222222], [-45.00013888888889, -22.449861111111108], [-45.00013888888889, -22.451249999999998], [-45.00013888888889, -22.452638888888888], [-45.00013888888889, -22.454027777777775], [-45.00013888888889, -22.455416666666665], [-45.00013888888889, -22.456805555555555], [-45.00013888888889, -22.45819444444444], [-45.00013888888889, -22.45958333333333], [-45.00013888888889, -22.46097222222222], [-45.00013888888889, -22.462361111111107], [-45.00013888888889, -22.463749999999997], [-45.00013888888889, -22.465138888888887], [-45.00013888888889, -22.466527777777774], [-45.00013888888889, -22.467916666666664], [-45.00013888888889, -22.469305555555554], [-45.00013888888889, -22.470694444444444], [-45.00013888888889, -22.47208333333333], [-45.00013888888889, -22.47347222222222], [-45.00013888888889, -22.47486111111111], [-45.00013888888889, -22.476249999999997], [-45.00013888888889, -22.477638888888887], [-45.00013888888889, -22.479027777777777], [-45.00013888888889, -22.480416666666663], [-45.00013888888889, -22.481805555555553], [-45.00013888888889, -22.483194444444443], [-45.00013888888889, -22.48458333333333], [-45.00013888888889, -22.48597222222222], [-45.00013888888889, -22.48736111111111], [-45.00013888888889, -22.488749999999996], [-45.00013888888889, -22.490138888888886], [-45.00013888888889, -22.491527777777776], [-45.00013888888889, -22.492916666666666], [-45.00013888888889, -22.494305555555552], [-45.00013888888889, -22.495694444444442], [-45.00013888888889, -22.497083333333332], [-45.00013888888889, -22.49847222222222], [-45.00013888888889, -22.49986111111111], [-45.00013888888889, -22.50125], [-45.00013888888889, -22.502638888888885], [-45.00013888888889, -22.504027777777775], [-45.00013888888889, -22.505416666666665], [-45.00013888888889, -22.50680555555555], [-45.00013888888889, -22.50819444444444], [-45.00013888888889, -22.50958333333333], [-45.00013888888889, -22.51097222222222], [-45.00013888888889, -22.512361111111108], [-45.00013888888889, -22.513749999999998], [-45.00013888888889, -22.515138888888888], [-45.00013888888889, -22.516527777777775], [-45.00013888888889, -22.517916666666665], [-45.00013888888889, -22.519305555555555], [-45.00013888888889, -22.52069444444444]];


const originCoords = coordinates[0];
const destinyCoords = coordinates[coordinates.length - 1];

function animateLine(map, coordinates) {
    let currentSegment = 0;
    let segmentCoordinates = [coordinates[currentSegment]];

    function animateSegment() {
        const numPoints = 15;
        const lineString = turf.lineString([coordinates[currentSegment], coordinates[currentSegment + 1]]);
        const length = turf.length(lineString, { units: 'kilometers' });
        const interval = length / numPoints;

        for (let i = 1; i <= numPoints; i++) {
            const newCoord = turf.along(lineString, i * interval, { units: 'kilometers' }).geometry.coordinates;
            segmentCoordinates.push(newCoord);
            setTimeout(() => {
                map.getSource('route').setData({
                    'type': 'Feature',
                    'properties': {},
                    'geometry': {
                        'type': 'LineString',
                        'coordinates': segmentCoordinates
                    }
                });
            }, i * 40);
        }

        currentSegment++;

        if (currentSegment < coordinates.length - 1) {
            setTimeout(animateSegment, numPoints * 40);
        }
    }

    animateSegment();
}


    // Add origin marker with popup
    const originPopup = new mapboxgl.Popup({ closeButton: false, closeOnClick: false, offset: [0, -15] })
        .setHTML(`<p>Origin: ${originCoords[0].toFixed(6)}, ${originCoords[1].toFixed(6)}</p>`);

    new mapboxgl.Marker({ color: 'green' })
        .setLngLat(originCoords)
        .setPopup(originPopup)
        .addTo(map);

    // Add destiny marker with popup
    const destinyPopup = new mapboxgl.Popup({ closeButton: false, closeOnClick: false, offset: [0, -15] })
        .setHTML(`<p>Destiny: ${destinyCoords[0].toFixed(6)}, ${destinyCoords[1].toFixed(6)}</p>`);

    new mapboxgl.Marker({ color: 'red' })
        .setLngLat(destinyCoords)
        .setPopup(destinyPopup)
        .addTo(map)

        // Update the route's coordinates
        map.getSource('route').setData({
            'type': 'Feature',
            'properties': {},
            'geometry': {
                'type': 'LineString',
                'coordinates': coordinates
            }
        });

        // Animate the line
        animateLine(map, coordinates);

        // Direct the user's screen to the line and markers
        map.fitBounds(coordinates, {
            padding: 100
        });
    </script>
</body>
</html>
